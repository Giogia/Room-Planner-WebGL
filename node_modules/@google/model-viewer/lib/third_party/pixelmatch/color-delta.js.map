{"version":3,"file":"color-delta.js","sourceRoot":"","sources":["../../../src/third_party/pixelmatch/color-delta.ts"],"names":[],"mappings":"AAAA;;GAEG;AACH,6EAA6E;AAC7E,8EAA8E;AAC9E,gFAAgF;AAChF,UAAU;AAEV,+EAA+E;AAC/E,gFAAgF;AAChF,6BAA6B;AAC7B,MAAM,UAAU,UAAU,CACtB,IAA+B,EAC/B,IAA+B,EAC/B,CAAS,EACT,CAAS,EACT,QAAiB,KAAK;IACxB,IAAI,EAAE,GAAG,IAAI,CAAC,CAAC,GAAG,CAAC,CAAC,GAAG,GAAG,EAAE,EAAE,GAAG,IAAI,CAAC,CAAC,GAAG,CAAC,CAAC,GAAG,GAAG,EAE9C,EAAE,GAAG,KAAK,CAAC,IAAI,CAAC,CAAC,GAAG,CAAC,CAAC,EAAE,EAAE,CAAC,EAAE,EAAE,GAAG,KAAK,CAAC,IAAI,CAAC,CAAC,GAAG,CAAC,CAAC,EAAE,EAAE,CAAC,EACxD,EAAE,GAAG,KAAK,CAAC,IAAI,CAAC,CAAC,GAAG,CAAC,CAAC,EAAE,EAAE,CAAC,EAE3B,EAAE,GAAG,KAAK,CAAC,IAAI,CAAC,CAAC,GAAG,CAAC,CAAC,EAAE,EAAE,CAAC,EAAE,EAAE,GAAG,KAAK,CAAC,IAAI,CAAC,CAAC,GAAG,CAAC,CAAC,EAAE,EAAE,CAAC,EACxD,EAAE,GAAG,KAAK,CAAC,IAAI,CAAC,CAAC,GAAG,CAAC,CAAC,EAAE,EAAE,CAAC,EAE3B,CAAC,GAAG,KAAK,CAAC,EAAE,EAAE,EAAE,EAAE,EAAE,CAAC,GAAG,KAAK,CAAC,EAAE,EAAE,EAAE,EAAE,EAAE,CAAC,CAAC;IAE9C,IAAI,KAAK;QACP,OAAO,CAAC,CAAC,CAAE,6BAA6B;IAE1C,IAAI,CAAC,GAAG,KAAK,CAAC,EAAE,EAAE,EAAE,EAAE,EAAE,CAAC,GAAG,KAAK,CAAC,EAAE,EAAE,EAAE,EAAE,EAAE,CAAC,EACzC,CAAC,GAAG,KAAK,CAAC,EAAE,EAAE,EAAE,EAAE,EAAE,CAAC,GAAG,KAAK,CAAC,EAAE,EAAE,EAAE,EAAE,EAAE,CAAC,CAAC;IAE9C,OAAO,MAAM,GAAG,CAAC,GAAG,CAAC,GAAG,KAAK,GAAG,CAAC,GAAG,CAAC,GAAG,MAAM,GAAG,CAAC,GAAG,CAAC,CAAC;AACzD,CAAC;AAED,SAAS,KAAK,CAAC,CAAS,EAAE,CAAS,EAAE,CAAS;IAC5C,OAAO,CAAC,GAAG,UAAU,GAAG,CAAC,GAAG,UAAU,GAAG,CAAC,GAAG,UAAU,CAAC;AAC1D,CAAC;AACD,SAAS,KAAK,CAAC,CAAS,EAAE,CAAS,EAAE,CAAS;IAC5C,OAAO,CAAC,GAAG,UAAU,GAAG,CAAC,GAAG,UAAU,GAAG,CAAC,GAAG,UAAU,CAAC;AAC1D,CAAC;AACD,SAAS,KAAK,CAAC,CAAS,EAAE,CAAS,EAAE,CAAS;IAC5C,OAAO,CAAC,GAAG,UAAU,GAAG,CAAC,GAAG,UAAU,GAAG,CAAC,GAAG,UAAU,CAAC;AAC1D,CAAC;AAED,0CAA0C;AAC1C,SAAS,KAAK,CAAC,CAAS,EAAE,CAAS;IACjC,OAAO,GAAG,GAAG,CAAC,CAAC,GAAG,GAAG,CAAC,GAAG,CAAC,CAAC;AAC7B,CAAC;AAED,MAAM,UAAU,SAAS,CACrB,MAAkB,EAAE,GAAW,EAAE,CAAS,EAAE,CAAS,EAAE,CAAS;IAClE,MAAM,CAAC,GAAG,GAAG,CAAC,CAAC,GAAG,CAAC,CAAC;IACpB,MAAM,CAAC,GAAG,GAAG,CAAC,CAAC,GAAG,CAAC,CAAC;IACpB,MAAM,CAAC,GAAG,GAAG,CAAC,CAAC,GAAG,CAAC,CAAC;IACpB,MAAM,CAAC,GAAG,GAAG,CAAC,CAAC,GAAG,GAAG,CAAC;AACxB,CAAC","sourcesContent":["/* @license ISC\n * @see LICENSE\n */\n// NOTE(cdata): This is an adapted subset of the original pixelmatch library.\n// The top-level API of the original library has been omitted, as we only make\n// use of the lower-level features that aren't actually exported by the upstream\n// module.\n\n// calculate color difference according to the paper \"Measuring perceived color\n// difference using YIQ NTSC transmission color space in mobile applications\" by\n// Y. Kotsarenko and F. Ramos\nexport function colorDelta(\n    img1: {[index: number]: number},\n    img2: {[index: number]: number},\n    k: number,\n    m: number,\n    yOnly: boolean = false): number {\n  var a1 = img1[k + 3] / 255, a2 = img2[m + 3] / 255,\n\n      r1 = blend(img1[k + 0], a1), g1 = blend(img1[k + 1], a1),\n      b1 = blend(img1[k + 2], a1),\n\n      r2 = blend(img2[m + 0], a2), g2 = blend(img2[m + 1], a2),\n      b2 = blend(img2[m + 2], a2),\n\n      y = rgb2y(r1, g1, b1) - rgb2y(r2, g2, b2);\n\n  if (yOnly)\n    return y;  // brightness difference only\n\n  var i = rgb2i(r1, g1, b1) - rgb2i(r2, g2, b2),\n      q = rgb2q(r1, g1, b1) - rgb2q(r2, g2, b2);\n\n  return 0.5053 * y * y + 0.299 * i * i + 0.1957 * q * q;\n}\n\nfunction rgb2y(r: number, g: number, b: number): number {\n  return r * 0.29889531 + g * 0.58662247 + b * 0.11448223;\n}\nfunction rgb2i(r: number, g: number, b: number): number {\n  return r * 0.59597799 - g * 0.27417610 - b * 0.32180189;\n}\nfunction rgb2q(r: number, g: number, b: number): number {\n  return r * 0.21147017 - g * 0.52261711 + b * 0.31114694;\n}\n\n// blend semi-transparent color with white\nfunction blend(c: number, a: number): number {\n  return 255 + (c - 255) * a;\n}\n\nexport function drawPixel(\n    output: Uint8Array, pos: number, r: number, g: number, b: number) {\n  output[pos + 0] = r;\n  output[pos + 1] = g;\n  output[pos + 2] = b;\n  output[pos + 3] = 255;\n}\n"]}