{"version":3,"file":"magic-leap.js","sourceRoot":"","sources":["../../src/features/magic-leap.ts"],"names":[],"mappings":"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","sourcesContent":["/* @license\n * Copyright 2019 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the 'License');\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an 'AS IS' BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {property} from 'lit-element';\n\nimport ModelViewerElementBase, {$container, $scene} from '../model-viewer-base.js';\nimport {Constructor} from '../utilities.js';\n\nconst $showMlModel = Symbol('showMlModel');\nconst $hideMlModel = Symbol('hideMlModel');\nconst $isHeliosBrowser = Symbol('isHeliosBrowser');\nconst $mlModel = Symbol('mlModel');\n\n\n// NOTE(cdata): In tests, this seemed to line the hologram up with the scale of\n// an inline rendering in WebGL. Probably needs some tweaking, and possibly even\n// user-configuration, before we perfect this:\nconst DEFAULT_HOLOGRAM_INLINE_SCALE = 0.65;\n\n// NOTE(cdata): This probably needs to scale proportionally with the dimensions\n// of the inline model, but we need more experimentation to decide how that\n// should work:\nconst DEFAULT_HOLOGRAM_Z_OFFSET = '150px';\n\nexport declare interface MagicLeapInterface {\n  magicLeap: boolean;\n}\n\n/**\n * In order to use Magic Leap support, please include prismatic.js in your\n * page. If you do not include prismatic.js, Magic Leap support will not work.\n *\n * @see https://www.npmjs.com/package/@magicleap/prismatic\n */\nexport const MagicLeapMixin = <T extends Constructor<ModelViewerElementBase>>(\n    ModelViewerElement: T): Constructor<MagicLeapInterface>&T => {\n  class MagicLeapModelViewerElement extends ModelViewerElement {\n    @property({type: Boolean, attribute: 'magic-leap'})\n    magicLeap: boolean = false;\n\n    // NOTE(cdata): Check at construction time because the check is cheap\n    // and it makes testing easier\n    private[$isHeliosBrowser]: boolean = self.mlWorld != null;\n\n    private[$mlModel]: HTMLElement|null = null;\n\n    updated(changedProperties: Map<string, any>) {\n      super.updated(changedProperties);\n\n      if (!this[$isHeliosBrowser]) {\n        return;\n      }\n\n      if (!(changedProperties.has('magicLeap') ||\n            changedProperties.has('src'))) {\n        return;\n      }\n\n      const scene = this[$scene];\n\n      if (this.magicLeap) {\n        const hasMlModel = !!customElements.get('ml-model');\n\n        if (!hasMlModel) {\n          console.warn('<ml-model> is not registered. Is prismatic.js loaded?');\n        }\n\n        scene.pause();\n        this[$container].setAttribute('style', 'display: none;');\n        this[$showMlModel]();\n\n        if (changedProperties.has('src') && this.src &&\n            this.src !== this[$mlModel]!.getAttribute('src')) {\n          this[$mlModel]!.setAttribute('src', this.src);\n        }\n      } else {\n        this[$hideMlModel]();\n        scene.resume();\n        this[$container].removeAttribute('style');\n      }\n    }\n\n    private[$showMlModel]() {\n      if (this[$mlModel] == null) {\n        this[$mlModel] = document.createElement('ml-model');\n        this[$mlModel]!.setAttribute(\n            'style',\n            'display: block; top: 0; left: 0; width: 100%; height: 100%');\n        // @see https://creator.magicleap.com/learn/guides/prismatic-getting-started\n        this[$mlModel]!.setAttribute(\n            'model-scale',\n            `${DEFAULT_HOLOGRAM_INLINE_SCALE} ${\n                DEFAULT_HOLOGRAM_INLINE_SCALE} ${\n                DEFAULT_HOLOGRAM_INLINE_SCALE}`);\n        this[$mlModel]!.setAttribute('z-offset', DEFAULT_HOLOGRAM_Z_OFFSET);\n        this[$mlModel]!.setAttribute('extractable', 'true');\n        this[$mlModel]!.setAttribute('extracted-scale', '1');\n        this[$mlModel]!.setAttribute(\n            'environment-lighting', 'color-intensity: 5;');\n\n        if (this.src != null) {\n          this[$mlModel]!.setAttribute('src', this.src);\n        }\n      }\n\n      this.shadowRoot!.appendChild(this[$mlModel]!);\n    }\n\n    private[$hideMlModel]() {\n      if (this[$mlModel] == null) {\n        return;\n      }\n\n      if (this[$mlModel]!.parentNode != null) {\n        this[$mlModel]!.parentNode!.removeChild(this[$mlModel]!);\n      }\n    }\n  }\n\n  return MagicLeapModelViewerElement;\n}\n"]}