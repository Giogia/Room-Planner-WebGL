{"version":3,"file":"magnifying-glass.js","sourceRoot":"","sources":["../../../../src/test/fidelity/components/magnifying-glass.ts"],"names":[],"mappings":"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","sourcesContent":["/* @license\n * Copyright 2019 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n\nimport {html, LitElement, property} from 'lit-element';\n\nimport {Pixel} from '../common.js';\nimport {ImageAccessor} from '../image-accessor.js';\n\nconst PIXEL_SIZE = 10;\n\nexport class MagnifyingGlass extends LitElement {\n  @property({type: Object}) imageAccessor: ImageAccessor|null = null;\n  @property({type: Object}) pixel: Pixel|null = null;\n  @property({type: String}) direction: string = 'vertical';\n\n  @property({type: Object}) position: Pixel = {x: 0, y: 0};\n\n  protected context: CanvasRenderingContext2D|null = null;\n\n  @property({type: Boolean}) protected xRay: boolean = true;\n  @property({type: Number}) protected reticleSize: number = 1;\n\n  protected enhance() {\n    if (this.pixel == null || this.imageAccessor == null) {\n      return;\n    }\n\n    this.classList.remove('hidden');\n\n    if (this.context == null) {\n      const canvas = this.shadowRoot!.querySelector('canvas');\n\n      if (canvas == null) {\n        return;\n      }\n\n      this.context = canvas.getContext('2d')!;\n    }\n\n    const {context} = this;\n    const rect = this.getBoundingClientRect();\n    const scale = rect.width / this.imageAccessor!.width;\n\n    for (let y = 0; y < 24; ++y) {\n      for (let x = 0; x < 24; ++x) {\n        context.fillStyle = this.imageAccessor!.cssColorAt(\n            this.pixel.x + x - 12, this.pixel.y + y - 12);\n        context.fillRect(\n            x * PIXEL_SIZE, y * PIXEL_SIZE, PIXEL_SIZE, PIXEL_SIZE);\n      }\n    }\n\n    this.reticleSize = Math.round(26 * scale);\n    this.position = {\n      x: this.pixel.x * scale - 130,\n      y: this.pixel.y * scale - 130\n    };\n  }\n\n  toggleXRay() {\n    this.xRay = !this.xRay;\n  }\n\n  protected hide() {\n    this.classList.add('hidden');\n  }\n\n  get glassPosition() {\n    const {width, height} =\n        this.imageAccessor != null ? this.imageAccessor : {width: 0, height: 0};\n    const {x, y} = this.pixel != null ? this.pixel : {x: 0, y: 0};\n\n    return this.direction === 'horizontal' ?\n        x < (width / 2) ? 'right' : 'left' :\n        y < (height / 2) ? 'bottom' : 'top';\n  }\n\n  render() {\n    this.enhance();\n\n    return html`\n<style>\n:host {\n  display: block;\n  position: relative;\n}\n\n#glass {\n  display: block;\n  position: absolute;\n  box-sizing: border-box;\n  top: 0;\n  left: 0;\n  width: 260px;\n  height: 260px;\n  transition: transform 0.1s;\n  z-index: 1;\n  background-color: transparent;\n}\n\ncanvas {\n  box-sizing: border-box;\n  box-shadow: 0 2px 10px rgba(40, 40, 40, 0.25);\n  width: 100%;\n  height: 100%;\n  transition: opacity 0.3s, transform 0.5s;\n  opacity: 1;\n}\n\n#glass.top canvas {\n  transform: translate(0, -180px);\n}\n\n#glass.bottom canvas {\n  transform: translate(0, 180px);\n}\n\n#glass.left canvas {\n  transform: translate(-180px, 0);\n}\n\n#glass.right canvas {\n  transform: translate(180px, 0);\n}\n\n#glass:before {\n  content: '';\n  display: block;\n  position: absolute;\n  top: 0;\n  left: 0;\n  transform: translate(calc(-50% + 130px), calc(130px - var(--reticle-size) / 2));\n  box-sizing: border-box;\n  border: 1px solid black;\n  width: var(--reticle-size);\n  height: var(--reticle-size);\n}\n\n#glass:after {\n  content: '';\n  display: block;\n  position: absolute;\n  top: 0;\n  left: 0;\n  transform: translate(calc(-50% + 130px), calc(129px - var(--reticle-size) / 2));\n  box-sizing: border-box;\n\n  border: 1px solid white;\n\n  width: calc(var(--reticle-size) + 2px);\n  height: calc(var(--reticle-size) + 2px);\n}\n\n:host(.hidden) canvas {\n  opacity: 0;\n}\n</style>\n<slot></slot>\n<div id=\"glass\"\n    class=\"${this.glassPosition}\"\n    style=\"transform: translate(${this.position.x}px, ${\n        this.position.y}px); --reticle-size: ${this.reticleSize}px\"\n    @click=\"${() => this.toggleXRay()}\">\n  <canvas style=\"opacity: ${this.xRay ? 0 : 1};\" width=\"240\" height=\"240\">\n</div>\n</canvas>\n`;\n  }\n}\n\ncustomElements.define('magnifying-glass', MagnifyingGlass);\n"]}