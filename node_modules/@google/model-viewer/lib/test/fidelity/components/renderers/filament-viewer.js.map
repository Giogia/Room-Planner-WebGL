{"version":3,"file":"filament-viewer.js","sourceRoot":"","sources":["../../../../../src/test/fidelity/components/renderers/filament-viewer.ts"],"names":[],"mappings":"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","sourcesContent":["/* @license\n * Copyright 2019 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {css, customElement, html, LitElement, property} from 'lit-element';\n\nimport {resolveDpr} from '../../../../utilities.js';\n\nimport {ScenarioConfig} from '../../common.js';\n\nconst fetchFilamentAssets = async(assets: Array<string>): Promise<void> =>\n    new Promise((resolve) => {\n      self.Filament.fetch(assets, () => resolve(), () => {});\n    });\n\nconst basepath = (urlString: string): string => {\n  const url = new URL(urlString, self.location.toString());\n  const {pathname} = url;\n  url.pathname = pathname.slice(0, pathname.lastIndexOf('/') + 1);\n  return url.toString();\n};\n\nconst IS_BINARY_RE = /\\.glb$/;\n\nconst $engine = Symbol('engine');\nconst $scene = Symbol('scene');\nconst $ibl = Symbol('ibl');\nconst $skybox = Symbol('skybox');\nconst $swapChain = Symbol('swapChain');\nconst $renderer = Symbol('renderer');\nconst $camera = Symbol('camera');\nconst $view = Symbol('view');\nconst $canvas = Symbol('canvas');\nconst $currentAsset = Symbol('currentAsset');\n\nconst $initialize = Symbol('initialize');\nconst $updateScenario = Symbol('scenario');\nconst $updateSize = Symbol('updateSize');\nconst $render = Symbol('render');\nconst $rendering = Symbol('rendering');\n\n@customElement('filament-viewer')\nexport class FilamentViewer extends LitElement {\n  @property({type: Object}) scenario: ScenarioConfig|null = null;\n\n  private[$rendering]: boolean = false;\n  private[$engine]: any = null;\n  private[$scene]: any = null;\n  private[$renderer]: any = null;\n  private[$swapChain]: any = null;\n  private[$camera]: any = null;\n  private[$view]: any = null;\n\n  private[$ibl]: any = null;\n  private[$skybox]: any = null;\n  private[$currentAsset]: any = null;\n\n  private[$canvas]: HTMLCanvasElement|null = null;\n\n  constructor() {\n    super();\n\n    self.Filament.init([], () => {\n      this[$initialize]();\n    });\n  }\n\n  connectedCallback() {\n    super.connectedCallback();\n    this[$render]();\n  }\n\n  disconnectedCallback() {\n    this[$rendering] = false;\n  }\n\n  updated(changedProperties: Map<string, any>) {\n    super.updated(changedProperties);\n\n    if (changedProperties.has('scenario') && this.scenario != null) {\n      this[$updateScenario](this.scenario);\n    }\n  }\n\n  static get styles() {\n    return css`\n:host {\n  display: block;\n}\n`;\n  }\n\n  render() {\n    return html`<canvas id=\"canvas\"></canvas>`;\n  }\n\n  private[$initialize]() {\n    const {Filament} = self;\n\n    this[$canvas] = this.shadowRoot!.querySelector('canvas');\n    this[$engine] = Filament.Engine.create(this[$canvas]);\n    this[$scene] = this[$engine].createScene();\n    this[$swapChain] = this[$engine].createSwapChain();\n    this[$renderer] = this[$engine].createRenderer();\n    this[$camera] = this[$engine].createCamera();\n    this[$view] = this[$engine].createView();\n    this[$view].setCamera(this[$camera]);\n    this[$view].setScene(this[$scene]);\n\n    this[$updateSize]();\n  }\n\n  private async[$updateScenario](scenario: ScenarioConfig) {\n    const modelUrl =\n        new URL(scenario.model, window.location.toString()).toString();\n    const lightingBaseName = (scenario.lighting.split('/').pop() as string)\n                                 .split('.')\n                                 .slice(0, -1)\n                                 .join('');\n    const iblUrl = `./ktx/${lightingBaseName}/${lightingBaseName}_ibl.ktx`;\n    const skyboxUrl =\n        `./ktx/${lightingBaseName}/${lightingBaseName}_skybox.ktx`;\n\n    console.log('Scenario:', scenario.name);\n    console.log('Lighting:', lightingBaseName);\n\n    if (this[$currentAsset] != null) {\n      const entities = this[$currentAsset].getEntities();\n      const size = entities.size();\n\n      for (let i = 0; i < size; ++i) {\n        const entity = entities.get(i);\n        this[$scene].remove(entity);\n        this[$engine].destroyEntity(entity);\n      }\n\n      this[$currentAsset] = null;\n    }\n\n    if (this[$ibl] != null) {\n      this[$engine].destroyIndirectLight(this[$ibl]);\n      this[$ibl] = null;\n    }\n\n    if (this[$skybox] != null) {\n      this[$engine].destroySkybox(this[$skybox]);\n      this[$skybox] = null;\n    }\n\n    await fetchFilamentAssets([modelUrl, iblUrl, skyboxUrl]);\n\n    this[$ibl] = this[$engine].createIblFromKtx(iblUrl);\n    this[$scene].setIndirectLight(this[$ibl]);\n    this[$ibl].setIntensity(1.0);\n    this[$ibl].setRotation([0, 0, -1, 0, 1, 0, 1, 0, 0]);  // 90 degrees\n\n    this[$skybox] = this[$engine].createSkyFromKtx(skyboxUrl);\n    this[$scene].setSkybox(this[$skybox]);\n\n    const loader = this[$engine].createAssetLoader();\n    this[$currentAsset] = IS_BINARY_RE.test(modelUrl) ?\n        loader.createAssetFromBinary(modelUrl) :\n        loader.createAssetFromJson(modelUrl);\n\n    const finalize = (await new Promise((resolve) => {\n                       console.log('Loading resources for', modelUrl);\n                       this[$currentAsset].loadResources(\n                           resolve, () => {}, basepath(modelUrl));\n                     })) as () => void;\n\n    finalize();\n    loader.delete();\n\n    this[$scene].addEntities(this[$currentAsset].getEntities());\n\n    this[$updateSize]();\n\n    // Wait two rAFs to ensure we rendered at least once:\n    requestAnimationFrame(() => {\n      requestAnimationFrame(() => {\n        this.dispatchEvent(\n            new CustomEvent('model-visibility', {detail: {visible: true}}));\n      });\n    });\n  }\n\n  private[$render]() {\n    this[$rendering] = true;\n\n    if (this[$renderer] != null) {\n      this[$renderer].render(this[$swapChain], this[$view]);\n    }\n\n    self.requestAnimationFrame(() => {\n      if (this[$rendering]) {\n        this[$render]();\n      }\n    });\n  }\n\n  private[$updateSize]() {\n    if (this[$canvas] == null || this.scenario == null) {\n      // Not initialized yet. This will be invoked again when initialized.\n      return;\n    }\n\n    const Fov = self.Filament.Camera$Fov;\n    const canvas = this[$canvas]!;\n    const {dimensions, target, orbit, verticalFoV} = this.scenario;\n\n    const dpr = resolveDpr();\n    const width = dimensions.width * dpr;\n    const height = dimensions.height * dpr;\n\n    canvas.width = width;\n    canvas.height = height;\n    canvas.style.width = `${dimensions.width}px`;\n    canvas.style.height = `${dimensions.height}px`;\n\n    this[$view].setViewport([0, 0, width, height]);\n\n    const aspect = width / height;\n\n    const center = [target.x, target.y, target.z];\n\n    const theta = orbit.theta * Math.PI / 180;\n    const phi = orbit.phi * Math.PI / 180;\n    const radiusSinPhi = orbit.radius * Math.sin(phi);\n    const eye = [\n      radiusSinPhi * Math.sin(theta) + target.x,\n      orbit.radius * Math.cos(phi) + target.y,\n      radiusSinPhi * Math.cos(theta) + target.z\n    ];\n\n    const near = orbit.radius / 10.0;\n    const far = orbit.radius * 10.0;\n\n    this[$camera].setProjectionFov(\n        verticalFoV, aspect, near, far, Fov!.VERTICAL);\n    const up = [0, 1, 0];\n    this[$camera].lookAt(eye, center, up);\n    this[$camera].setExposure(1.0, 1.2, 100);\n  }\n}"]}