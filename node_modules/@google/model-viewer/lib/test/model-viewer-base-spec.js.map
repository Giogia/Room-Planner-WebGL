{"version":3,"file":"model-viewer-base-spec.js","sourceRoot":"","sources":["../../src/test/model-viewer-base-spec.ts"],"names":[],"mappings":"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","sourcesContent":["/* @license\n * Copyright 2019 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the 'License');\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an 'AS IS' BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {IS_IE11} from '../constants.js';\nimport ModelViewerElementBase, {$canvas, $renderer, $scene} from '../model-viewer-base.js';\nimport {Constructor} from '../utilities.js';\n\nimport {assetPath, timePasses, until, waitForEvent} from './helpers.js';\nimport {BasicSpecTemplate} from './templates.js';\n\n\nconst expect = chai.expect;\n\nsuite('ModelViewerElementBase', () => {\n  test('is not registered as a custom element by default', () => {\n    expect(customElements.get('model-viewer-base')).to.be.equal(undefined);\n  });\n\n  suite('when registered', () => {\n    let nextId = 0;\n    let tagName: string;\n    let ModelViewerElement: Constructor<ModelViewerElementBase>;\n\n    setup(() => {\n      tagName = `model-viewer-${nextId++}`;\n      ModelViewerElement = class extends ModelViewerElementBase {\n        static get is() {\n          return tagName;\n        }\n      };\n      customElements.define(tagName, ModelViewerElement);\n    });\n\n    BasicSpecTemplate(() => ModelViewerElement, () => tagName);\n\n    suite('with alt text', () => {\n      let element: ModelViewerElementBase;\n      let canvas: HTMLCanvasElement;\n\n      setup(() => {\n        element = new ModelViewerElement();\n        canvas = element[$canvas];\n        document.body.appendChild(element);\n      });\n\n      teardown(() => {\n        if (element.parentNode != null) {\n          element.parentNode.removeChild(element);\n        }\n      });\n\n      test('gives the canvas a related aria-label', async () => {\n        const altText = 'foo';\n        const canvas = element[$canvas];\n        element.alt = altText;\n        await timePasses();\n        expect(canvas.getAttribute('aria-label')).to.be.equal(altText);\n      });\n\n      suite('that is removed', () => {\n        test('reverts canvas to default aria-label', async () => {\n          const defaultAriaLabel = canvas.getAttribute('aria-label');\n          const altText = 'foo';\n\n          element.alt = altText;\n          await timePasses();\n          element.alt = null;\n          await timePasses();\n\n          expect(canvas.getAttribute('aria-label'))\n              .to.be.equal(defaultAriaLabel);\n        });\n      });\n    });\n\n    suite('with a valid src', () => {\n      let element: ModelViewerElementBase;\n      setup(() => {\n        element = new ModelViewerElement();\n        document.body.appendChild(element);\n      });\n\n      teardown(() => {\n        if (element.parentNode != null) {\n          element.parentNode.removeChild(element);\n        }\n      });\n\n      test('eventually dispatches a load event', async () => {\n        const sourceLoads = waitForEvent(element, 'load');\n        element.src = assetPath('Astronaut.glb');\n        await sourceLoads;\n      });\n\n\n      suite('that changes before the model loads', () => {\n        test('it loads the second value on microtask timing', async () => {\n          element.src = assetPath('Astronaut.glb');\n          await timePasses();\n          element.src = assetPath('Horse.glb');\n          await waitForEvent(element, 'load');\n\n          expect(element[$scene].model.userData.url)\n              .to.be.equal(assetPath('Horse.glb'));\n        });\n\n        test('it loads the second value on task timing', async () => {\n          element.src = assetPath('Astronaut.glb');\n          await timePasses(1);\n          element.src = assetPath('Horse.glb');\n          await waitForEvent(element, 'load');\n\n          expect(element[$scene].model.userData.url)\n              .to.be.equal(assetPath('Horse.glb'));\n        });\n      });\n    });\n\n    suite('with an invalid src', () => {\n      let element: ModelViewerElementBase;\n      setup(() => {\n        element = new ModelViewerElement();\n        document.body.appendChild(element);\n      });\n\n      teardown(() => {\n        if (element.parentNode != null) {\n          element.parentNode.removeChild(element);\n        }\n      });\n\n      test('eventually dispatches an error event', async () => {\n        const sourceErrors = waitForEvent(element, 'error');\n        element.src = './does-not-exist.glb';\n        await sourceErrors;\n      });\n    });\n\n    suite('when losing the GL context', () => {\n      let element: ModelViewerElementBase;\n      setup(() => {\n        element = new ModelViewerElement();\n        document.body.appendChild(element);\n      });\n\n      teardown(() => {\n        if (element.parentNode != null) {\n          element.parentNode.removeChild(element);\n        }\n      });\n\n      test('dispatches a related error event', async () => {\n        const renderer = element[$renderer].renderer;\n        const errorEventDispatches = waitForEvent(element, 'error');\n        // We make a best effor to simulate the real scenario here, but\n        // for some cases like headless Chrome WebGL might be disabled,\n        // so we simulate the scenario.\n        // @see https://threejs.org/docs/index.html#api/en/renderers/WebGLRenderer.forceContextLoss\n        if (renderer.context != null && !IS_IE11) {\n          renderer.forceContextLoss();\n        } else {\n          renderer.domElement.dispatchEvent(\n              new CustomEvent('webglcontextlost'));\n        }\n        const event = await errorEventDispatches;\n        expect((event as any).detail.type).to.be.equal('webglcontextlost');\n      });\n    });\n\n    suite('capturing screenshots', () => {\n      let element: ModelViewerElementBase;\n      setup(async () => {\n        element = new ModelViewerElement();\n\n        // Avoid testing our memory ceiling in CI by limiting the size\n        // of the screenshots we produce in these tests:\n        element.style.width = '64px';\n        element.style.height = '64px';\n\n        document.body.appendChild(element);\n\n        const modelLoads = waitForEvent(element, 'load');\n        element.src = assetPath('cube.gltf');\n        await modelLoads;\n      });\n\n      teardown(() => {\n        if (element.parentNode != null) {\n          element.parentNode.removeChild(element);\n        }\n      });\n\n      suite('toDataURL', () => {\n        test('produces a URL-compatible string', () => {\n          const dataUrlMatcher = /^data\\:image\\//;\n          expect(dataUrlMatcher.test(element.toDataURL())).to.be.true;\n        });\n      });\n    });\n\n    suite('orchestrates rendering', () => {\n      let elements: Array<ModelViewerElementBase> = [];\n\n      setup(async () => {\n        elements.push(new ModelViewerElement());\n        elements.push(new ModelViewerElement());\n        elements.push(new ModelViewerElement());\n\n        const loaded = elements.map(e => waitForEvent(e, 'load'));\n\n        for (let element of elements) {\n          element.style.position = 'relative';\n          element.style.marginBottom = '100vh';\n          element.src = assetPath('cube.gltf');\n          document.body.appendChild(element);\n        }\n\n        await Promise.all(loaded);\n      });\n\n      teardown(() => {\n        elements.forEach(\n            element => element.parentNode != null &&\n                element.parentNode.removeChild(element));\n      });\n\n      test('sets a model within viewport to be visible', async () => {\n        await until(() => {\n          return elements[0][$scene].visible;\n        });\n\n        expect(elements[0][$scene].visible).to.be.true;\n      });\n\n      test.skip('only models visible in the viewport', async () => {\n        // IntersectionObserver needs to set appropriate\n        // visibility on the scene, lots of timing issues when\n        // running -- wait for the visibility flags to be flipped\n        await until(() => {\n          return elements\n              .map((element, index) => {\n                return (index === 0) === element[$scene].visible;\n              })\n              .reduce(((l, r) => l && r), true);\n        });\n\n        expect(elements[0][$scene].visible).to.be.ok;\n        expect(elements[1][$scene].visible).to.not.be.ok;\n        expect(elements[2][$scene].visible).to.not.be.ok;\n      });\n    });\n  });\n});\n"]}