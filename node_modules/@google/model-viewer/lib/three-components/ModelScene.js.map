{"version":3,"file":"ModelScene.js","sourceRoot":"","sources":["../../src/three-components/ModelScene.ts"],"names":[],"mappings":"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","sourcesContent":["/* @license\n * Copyright 2019 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the 'License');\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an 'AS IS' BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {BackSide, BoxBufferGeometry, Camera, Color, Event as ThreeEvent, Object3D, PerspectiveCamera, Scene, Shader, ShaderLib, ShaderMaterial, Vector3} from 'three';\nimport {Mesh} from 'three';\n\nimport ModelViewerElementBase from '../model-viewer-base.js';\nimport {resolveDpr} from '../utilities.js';\n\nimport Model from './Model.js';\nimport {Renderer} from './Renderer.js';\nimport {cubeUVChunk} from './shader-chunk/cube_uv_reflection_fragment.glsl.js';\nimport StaticShadow from './StaticShadow.js';\n\nexport interface ModelLoadEvent extends ThreeEvent {\n  url: string\n}\n\nexport interface ModelSceneConfig {\n  element: ModelViewerElementBase;\n  canvas: HTMLCanvasElement;\n  width: number;\n  height: number;\n  renderer: Renderer;\n}\n\nexport type IlluminationRole = 'primary'|'secondary'\n\nexport const IlluminationRole: {[index: string]: IlluminationRole} = {\n  Primary: 'primary',\n  Secondary: 'secondary'\n};\n\nconst $paused = Symbol('paused');\n\n/**\n * A THREE.Scene object that takes a Model and CanvasHTMLElement and\n * constructs a framed scene based off of the canvas dimensions.\n * Provides lights and cameras to be used in a renderer.\n */\nexport default class ModelScene extends Scene {\n  private[$paused]: boolean = false;\n\n  public aspect = 1;\n  public canvas: HTMLCanvasElement;\n  public renderer: Renderer;\n  public shadow: StaticShadow;\n  public pivot: Object3D;\n  public pivotCenter: Vector3;\n  public width = 1;\n  public height = 1;\n  public isVisible: boolean = false;\n  public isDirty: boolean = false;\n  public element: ModelViewerElementBase;\n  public context: CanvasRenderingContext2D;\n  public exposure = 1;\n  public model: Model;\n  public skyboxMesh: Mesh;\n  public activeCamera: Camera;\n  // These default camera values are never used, as they are reset once the\n  // model is loaded and framing is computed.\n  public camera = new PerspectiveCamera(45, 1, 0.1, 100);\n\n  constructor({canvas, element, width, height, renderer}: ModelSceneConfig) {\n    super();\n\n    this.name = 'ModelScene';\n\n    this.element = element;\n    this.canvas = canvas;\n    this.context = canvas.getContext('2d')!;\n    this.renderer = renderer;\n\n    this.model = new Model();\n    this.shadow = new StaticShadow();\n\n    // These default camera values are never used, as they are reset once the\n    // model is loaded and framing is computed.\n    this.camera = new PerspectiveCamera(45, 1, 0.1, 100);\n    this.camera.name = 'MainCamera';\n\n    this.activeCamera = this.camera;\n    this.pivot = new Object3D();\n    this.pivot.name = 'Pivot';\n    this.pivotCenter = new Vector3;\n\n    this.skyboxMesh = this.createSkyboxMesh();\n\n    this.add(this.pivot);\n    this.pivot.add(this.model);\n\n    this.setSize(width, height);\n    this.background = new Color(0xffffff);\n\n    this.model.addEventListener(\n        'model-load', (event: any) => this.onModelLoad(event));\n  }\n\n  get paused() {\n    return this[$paused];\n  }\n\n  pause() {\n    this[$paused] = true;\n  }\n\n  resume() {\n    this[$paused] = false;\n  }\n\n  /**\n   * Sets the model via URL.\n   */\n  async setModelSource(\n      source: string|null, progressCallback?: (progress: number) => void) {\n    try {\n      await this.model.setSource(source, progressCallback);\n    } catch (e) {\n      throw new Error(\n          `Could not set model source to '${source}': ${e.message}`);\n    }\n  }\n\n  /**\n   * Receives the size of the 2D canvas element to make according\n   * adjustments in the scene.\n   */\n  setSize(width: number, height: number) {\n    if (width !== this.width || height !== this.height) {\n      this.width = Math.max(width, 1);\n      this.height = Math.max(height, 1);\n      // In practice, invocations of setSize are throttled at the element level,\n      // so no need to throttle here:\n      const dpr = resolveDpr();\n      this.canvas.width = this.width * dpr;\n      this.canvas.height = this.height * dpr;\n      this.canvas.style.width = `${this.width}px`;\n      this.canvas.style.height = `${this.height}px`;\n      this.aspect = this.width / this.height;\n\n      // Immediately queue a render to happen at microtask timing. This is\n      // necessary because setting the width and height of the canvas has the\n      // side-effect of clearing it, and also if we wait for the next rAF to\n      // render again we might get hit with yet-another-resize, or worse we\n      // may not actually be marked as dirty and so render will just not\n      // happen. Queuing a render to happen here means we will render twice on\n      // a resize frame, but it avoids most of the visual artifacts associated\n      // with other potential mitigations for this problem. See discussion in\n      // https://github.com/GoogleWebComponents/model-viewer/pull/619 for\n      // additional considerations.\n      Promise.resolve().then(() => {\n        this.renderer.render(performance.now());\n      });\n    }\n  }\n\n  /**\n   * Returns the size of the corresponding canvas element.\n   */\n  getSize(): {width: number, height: number} {\n    return {width: this.width, height: this.height};\n  }\n\n  resetModelPose() {\n    this.model.position.set(0, 0, 0);\n    this.model.rotation.set(0, 0, 0);\n    this.model.scale.set(1, 1, 1);\n  }\n\n  /**\n   * Returns the current camera.\n   */\n  getCamera(): Camera {\n    return this.activeCamera;\n  }\n\n  /**\n   * Sets the passed in camera to be used for rendering.\n   */\n  setCamera(camera: Camera) {\n    this.activeCamera = camera;\n  }\n\n  /**\n   * Sets the rotation of the model's pivot, around its pivotCenter point.\n   */\n  setPivotRotation(radiansY: number) {\n    this.pivot.rotation.y = radiansY;\n    this.pivot.position.x = -this.pivotCenter.x;\n    this.pivot.position.z = -this.pivotCenter.z;\n    this.pivot.position.applyAxisAngle(this.pivot.up, radiansY);\n    this.pivot.position.x += this.pivotCenter.x;\n    this.pivot.position.z += this.pivotCenter.z;\n  }\n\n  /**\n   * Gets the current rotation value of the pivot\n   */\n  getPivotRotation(): number {\n    return this.pivot.rotation.y;\n  }\n\n  /**\n   * Called when the model's contents have loaded, or changed.\n   */\n  onModelLoad(event: {url: string}) {\n    this.updateStaticShadow();\n    this.dispatchEvent({type: 'model-load', url: event.url});\n  }\n\n  /**\n   * Called to update the shadow rendering when the model changes.\n   */\n  updateStaticShadow() {\n    if (!this.model.hasModel() || this.model.size.length() === 0) {\n      this.pivot.remove(this.shadow);\n      return;\n    }\n\n    // Remove and cache the current pivot rotation so that the shadow's\n    // capture is unrotated so it can be freely rotated when applied\n    // as a texture.\n    const currentRotation = this.pivot.rotation.y;\n    this.setPivotRotation(0);\n\n    this.shadow.render(this.renderer.renderer, this);\n\n    // Lazily add the shadow so we're only displaying it once it has\n    // a generated texture.\n    this.pivot.add(this.shadow);\n    this.setPivotRotation(currentRotation);\n  }\n\n  createSkyboxMesh(): Mesh {\n    const geometry = new BoxBufferGeometry(1, 1, 1);\n    geometry.removeAttribute('normal');\n    geometry.removeAttribute('uv');\n    const material = new ShaderMaterial({\n      uniforms: {envMap: {value: null}, opacity: {value: 1.0}},\n      vertexShader: ShaderLib.cube.vertexShader,\n      fragmentShader: ShaderLib.cube.fragmentShader,\n      side: BackSide,\n      // Turn off the depth buffer so that even a small box still ends up\n      // enclosing a scene of any size.\n      depthTest: false,\n      depthWrite: false,\n      fog: false,\n    });\n    material.extensions = {\n      derivatives: true,\n      fragDepth: false,\n      drawBuffers: false,\n      shaderTextureLOD: false\n    };\n    const samplerUV = `\n#define ENVMAP_TYPE_CUBE_UV\n#define PI 3.14159265359\n${cubeUVChunk}\nuniform sampler2D envMap;\n    `;\n    material.onBeforeCompile = (shader: Shader) => {\n      shader.fragmentShader =\n          shader.fragmentShader.replace('uniform samplerCube tCube;', samplerUV)\n              .replace(\n                  'vec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );',\n                  'gl_FragColor = textureCubeUV( envMap, vWorldDirection, 0.0 );')\n              .replace('gl_FragColor = mapTexelToLinear( texColor );', '');\n    };\n    const skyboxMesh = new Mesh(geometry, material);\n    skyboxMesh.frustumCulled = false;\n    // This centers the box on the camera, ensuring the view is not affected by\n    // the camera's motion, which makes it appear inifitely large, as it should.\n    skyboxMesh.onBeforeRender = function(_renderer, _scene, camera) {\n      this.matrixWorld.copyPosition(camera.matrixWorld);\n    };\n    return skyboxMesh;\n  }\n\n  skyboxMaterial(): ShaderMaterial {\n    return this.skyboxMesh.material as ShaderMaterial;\n  }\n}\n"]}