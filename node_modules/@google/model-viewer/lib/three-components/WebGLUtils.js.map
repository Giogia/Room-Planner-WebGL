{"version":3,"file":"WebGLUtils.js","sourceRoot":"","sources":["../../src/three-components/WebGLUtils.ts"],"names":[],"mappings":"AAAA;;;;;;;;;;;;;GAaG;AAEH,MAAM,CAAC,MAAM,aAAa,GACtB,CAAC,OAAmC,EAAyB,EAAE;IAC7D,IAAI,OAAO,IAAI,IAAI,EAAE;QACnB,MAAM,IAAI,KAAK,CAAC,yBAAyB,CAAC,CAAC;KAC5C;IACD,OAAO,OAAO,CAAC;AACjB,CAAC,CAAC;AAEN,MAAM,CAAC,MAAM,UAAU,GACnB,CAAC,MAAyB,EAAE,OAA+B,EACjC,EAAE,CAAC,aAAa,CAClC,MAAM,CAAC,UAAU,CAAC,OAAO,EAAE,OAAO,CAAC;IACnC,MAAM,CAAC,UAAU,CAAC,oBAAoB,EAAE,OAAO,CAEvC,CAAC,CAAC;AAEtB;;;GAGG;AACH,MAAM,CAAC,MAAM,2BAA2B,GAAG,CAAC,EAAyB,EAAE,EAAE;IACvE,MAAM,WAAW,GAA8B;QAC7C,6DAA6D;QAC7D,6DAA6D;QAC7D,qBAAqB;QACrB,4DAA4D;QAC5D,wBAAwB,EAAE;;;;;;QAMtB;KACL,CAAC;IAEF,SAAS,gBAAgB,CAAC,EAAyB,EAAE,IAAY;QAC/D,MAAM,MAAM,GAAG,EAAE,CAAC,YAAY,CAAC,EAAE,CAAC,eAAe,CAAC,CAAC;QACnD,EAAE,CAAC,YAAY,CAAC,MAAO,EAAE,WAAW,CAAC,IAAI,CAAC,CAAC,CAAC;QAC5C,EAAE,CAAC,aAAa,CAAC,MAAO,CAAC,CAAC;QAE1B,MAAM,MAAM,GAAG,EAAE,CAAC,kBAAkB,CAAC,MAAO,EAAE,EAAE,CAAC,cAAc,CAAC,CAAC;QAEjE,EAAE,CAAC,YAAY,CAAC,MAAM,CAAC,CAAC;QACxB,OAAO,MAAM,CAAC;IAChB,CAAC;IAED,MAAM,YAAY,GAAG,EAAE,CAAC,YAAY,CAAC;IACrC,EAAE,CAAC,YAAY,GAAG,CAAC,IAAY,EAAE,EAAE;QACjC,IAAI,SAAS,CAAC;QAEd,IAAI,WAAW,CAAC,IAAI,CAAC,EAAE;YACrB,SAAS,GAAG,YAAY,CAAC,IAAI,CAAC,EAAE,EAAE,IAAI,CAAC,CAAC;YACxC,IAAI,SAAS,IAAI,CAAC,gBAAgB,CAAC,EAAE,EAAE,IAAI,CAAC,EAAE;gBAC5C,SAAS,GAAG,IAAI,CAAC;aAClB;SACF;aAAM;YACL,SAAS,GAAG,YAAY,CAAC,IAAI,CAAC,EAAE,EAAE,IAAI,CAAC,CAAC;SACzC;QAED,OAAO,SAAS,CAAC;IACnB,CAAC,CAAC;AACJ,CAAC,CAAC","sourcesContent":["/* @license\n * Copyright 2019 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the 'License');\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an 'AS IS' BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nexport const assertContext =\n    (context: WebGLRenderingContext|null): WebGLRenderingContext => {\n      if (context == null) {\n        throw new Error('WebGL is not available!');\n      }\n      return context;\n    };\n\nexport const getContext =\n    (canvas: HTMLCanvasElement, options: WebGLContextAttributes):\n        WebGLRenderingContext => assertContext(\n            canvas.getContext('webgl', options) ||\n            canvas.getContext('experimental-webgl', options) as\n                    WebGLRenderingContext |\n                null);\n\n/**\n * Patch the values reported by WebGLRenderingContext's\n * extension store to fix compatibility issues.\n */\nexport const applyExtensionCompatibility = (gl: WebGLRenderingContext) => {\n  const testShaders: {[index: string]: string} = {\n    // In some Firefox builds (mobile Android on Pixel at least),\n    // EXT_shader_texture_lod is reported as being supported, but\n    // fails in practice.\n    // @see https://bugzilla.mozilla.org/show_bug.cgi?id=1451287\n    'EXT_shader_texture_lod': `\n      #extension GL_EXT_shader_texture_lod : enable\n      precision mediump float;\n      uniform sampler2D tex;\n      void main() {\n        gl_FragColor = texture2DLodEXT(tex, vec2(0.0, 0.0), 0.0);\n      }`,\n  };\n\n  function confirmExtension(gl: WebGLRenderingContext, name: string) {\n    const shader = gl.createShader(gl.FRAGMENT_SHADER);\n    gl.shaderSource(shader!, testShaders[name]);\n    gl.compileShader(shader!);\n\n    const status = gl.getShaderParameter(shader!, gl.COMPILE_STATUS);\n\n    gl.deleteShader(shader);\n    return status;\n  }\n\n  const getExtension = gl.getExtension;\n  gl.getExtension = (name: string) => {\n    let extension;\n\n    if (testShaders[name]) {\n      extension = getExtension.call(gl, name);\n      if (extension && !confirmExtension(gl, name)) {\n        extension = null;\n      }\n    } else {\n      extension = getExtension.call(gl, name);\n    }\n\n    return extension;\n  };\n};\n"]}