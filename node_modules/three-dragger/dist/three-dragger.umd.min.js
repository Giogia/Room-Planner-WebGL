/* @license three-dragger v1.0.1 | (c) Qingrong Ke <keqingrong1992@gmail.com> (https://keqingrong.github.io/) */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("three")):"function"==typeof define&&define.amd?define(["three"],t):e.ThreeDragger=t(e.THREE)}(this,function(e){"use strict";function t(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function n(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e){return(o=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function r(e,t){return(r=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function i(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function s(e,t,n){return(s="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=o(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}var c,u=(function(e){var t=Object.prototype.hasOwnProperty,n="~";function o(){}function r(e,t,o,r,i){if("function"!=typeof o)throw new TypeError("The listener must be a function");var s=new function(e,t,n){this.fn=e,this.context=t,this.once=n||!1}(o,r||e,i),c=n?n+t:t;return e._events[c]?e._events[c].fn?e._events[c]=[e._events[c],s]:e._events[c].push(s):(e._events[c]=s,e._eventsCount++),e}function i(e,t){0==--e._eventsCount?e._events=new o:delete e._events[t]}function s(){this._events=new o,this._eventsCount=0}Object.create&&(o.prototype=Object.create(null),(new o).__proto__||(n=!1)),s.prototype.eventNames=function(){var e,o,r=[];if(0===this._eventsCount)return r;for(o in e=this._events)t.call(e,o)&&r.push(n?o.slice(1):o);return Object.getOwnPropertySymbols?r.concat(Object.getOwnPropertySymbols(e)):r},s.prototype.listeners=function(e){var t=n?n+e:e,o=this._events[t];if(!o)return[];if(o.fn)return[o.fn];for(var r=0,i=o.length,s=new Array(i);r<i;r++)s[r]=o[r].fn;return s},s.prototype.listenerCount=function(e){var t=n?n+e:e,o=this._events[t];return o?o.fn?1:o.length:0},s.prototype.emit=function(e,t,o,r,i,s){var c=n?n+e:e;if(!this._events[c])return!1;var u,a,l=this._events[c],f=arguments.length;if(l.fn){switch(l.once&&this.removeListener(e,l.fn,void 0,!0),f){case 1:return l.fn.call(l.context),!0;case 2:return l.fn.call(l.context,t),!0;case 3:return l.fn.call(l.context,t,o),!0;case 4:return l.fn.call(l.context,t,o,r),!0;case 5:return l.fn.call(l.context,t,o,r,i),!0;case 6:return l.fn.call(l.context,t,o,r,i,s),!0}for(a=1,u=new Array(f-1);a<f;a++)u[a-1]=arguments[a];l.fn.apply(l.context,u)}else{var v,p=l.length;for(a=0;a<p;a++)switch(l[a].once&&this.removeListener(e,l[a].fn,void 0,!0),f){case 1:l[a].fn.call(l[a].context);break;case 2:l[a].fn.call(l[a].context,t);break;case 3:l[a].fn.call(l[a].context,t,o);break;case 4:l[a].fn.call(l[a].context,t,o,r);break;default:if(!u)for(v=1,u=new Array(f-1);v<f;v++)u[v-1]=arguments[v];l[a].fn.apply(l[a].context,u)}}return!0},s.prototype.on=function(e,t,n){return r(this,e,t,n,!1)},s.prototype.once=function(e,t,n){return r(this,e,t,n,!0)},s.prototype.removeListener=function(e,t,o,r){var s=n?n+e:e;if(!this._events[s])return this;if(!t)return i(this,s),this;var c=this._events[s];if(c.fn)c.fn!==t||r&&!c.once||o&&c.context!==o||i(this,s);else{for(var u=0,a=[],l=c.length;u<l;u++)(c[u].fn!==t||r&&!c[u].once||o&&c[u].context!==o)&&a.push(c[u]);a.length?this._events[s]=1===a.length?a[0]:a:i(this,s)}return this},s.prototype.removeAllListeners=function(e){var t;return e?(t=n?n+e:e,this._events[t]&&i(this,t)):(this._events=new o,this._eventsCount=0),this},s.prototype.off=s.prototype.removeListener,s.prototype.addListener=s.prototype.on,s.prefixed=n,s.EventEmitter=s,e.exports=s}(c={exports:{}},c.exports),c.exports),a=function(e){return e<-1?-1:e>1?1:e},l=function(t,n){var o={left:0,top:0,width:window.innerWidth,height:window.innerHeight};n&&"function"==typeof n.getBoundingClientRect&&Object.assign(o,n.getBoundingClientRect());var r=o.left,i=o.top,s=o.width,c=o.height;void 0!==t.clientX&&void 0!==t.clientY||console.warn("".concat(t," is not a standard DOM event, which misses clientX and clientY"));var u=(t.clientX-r)/s*2-1,l=-(t.clientY-i)/c*2+1;return new e.Vector2(a(u),a(l))},f={LEFT:0,MIDDLE:1,RIGHT:2};return function(c){function a(t,r,s){var c,u,v;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),u=this,v=o(a).call(this),n(i(i(c=!v||"object"!=typeof v&&"function"!=typeof v?i(u):v)),"onDocumentMouseDown",function(e){var t=i(i(c));if(t.enabled&&t.containsMousePoint(e)&&e.button===f.LEFT){e.preventDefault();var n=l(e,t.domElement),o=t.rayCast(n)||null;t.mouse=n,t.selected=o,t.emitEvent("mousedown",o,null,e)}}),n(i(i(c)),"onDocumentMouseMove",function(e){var t=i(i(c));if(t.enabled&&(e.preventDefault(),t.selected)){var n=l(e,t.domElement);if(n.equals(t.mouse))return;t.mouse=n,!1===t.dragging&&(t.plane.setFromNormalAndCoplanarPoint(t.camera.getWorldDirection(),t.selected.position),t.raycaster.setFromCamera(t.mouse,t.camera),t.raycaster.ray.intersectPlane(t.plane,t.intersection),t.offset.copy(t.intersection).sub(t.selected.position),t.domElement.style.cursor="move",t.emitEvent("dragstart",t.selected,t.selected.position.clone(),e),t.dragging=!0),t.raycaster.setFromCamera(t.mouse,t.camera),t.raycaster.ray.intersectPlane(t.plane,t.intersection),t.emitEvent("drag",t.selected,t.intersection.sub(t.offset).clone(),e)}}),n(i(i(c)),"onDocumentMouseUp",function(e){var t=i(i(c));if(t.enabled&&e.button===f.LEFT){if(e.preventDefault(),t.dragging&&t.selected)return t.domElement.style.cursor="auto",t.emitEvent("dragend",t.selected,t.intersection.clone(),e),t.selected=null,void(t.dragging=!1);t.selected=null,t.dragging=!1,t.containsMousePoint(e)&&(t.emitEvent("mouseup",null,null,e),t.emitEvent("click",null,null,e))}}),c.objects=t,c.camera=r,c.domElement=s,c.mouse=new e.Vector2,c.selected=null,c.offset=new e.Vector3,c.plane=new e.Plane,c.raycaster=new e.Raycaster,c.intersection=new e.Vector3,c.dragging=!1,c.enabled=!0,c.attachEvents(),c}var v,p,h;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&r(e,t)}(a,u),v=a,(p=[{key:"update",value:function(e){this.objects=e}},{key:"reset",value:function(){this.enabled=!0}},{key:"dispose",value:function(){this.detachEvents()}},{key:"attachEvents",value:function(){document.addEventListener("mousedown",this.onDocumentMouseDown,!1),document.addEventListener("mousemove",this.onDocumentMouseMove,!1),document.addEventListener("mouseup",this.onDocumentMouseUp,!1)}},{key:"detachEvents",value:function(){document.removeEventListener("mousedown",this.onDocumentMouseDown,!1),document.removeEventListener("mousemove",this.onDocumentMouseMove,!1),document.removeEventListener("mouseup",this.onDocumentMouseUp,!1)}},{key:"containsMousePoint",value:function(e){if(!this.domElement.getBoundingClientRect)return!0;var t=this.domElement.getBoundingClientRect(),n=t.top,o=t.right,r=t.bottom,i=t.left,s=e.clientX,c=e.clientY;return!(s<i||s>o||c<n||c>r)}},{key:"rayCast",value:function(e){var t;if(t=this.objects,Array.isArray(t)&&0===t.length)return null;this.raycaster.setFromCamera(e,this.camera);var n=this.raycaster.intersectObjects(this.objects,!0);return n.length>0?n[0].object:null}},{key:"emitEvent",value:function(e,t,n,r){s(o(a.prototype),"emit",this).call(this,e,{target:t,mouse:this.mouse,position:n,event:r})}}])&&t(v.prototype,p),h&&t(v,h),a}()});